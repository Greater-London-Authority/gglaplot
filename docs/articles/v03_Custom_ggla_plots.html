<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom <code>gglaplot</code>s • gglaplot</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Custom &lt;code&gt;gglaplot&lt;/code&gt;s">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gglaplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v01_Using_GLA_colour_palettes.html">Using GLA colour palettes</a>
    </li>
    <li>
      <a href="../articles/v02_Using_the_gla_theme.html">Using `theme_gla()`</a>
    </li>
    <li>
      <a href="../articles/v03_Custom_ggla_plots.html">Custom `gglaplot`s</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Greater-London-Authority/gglaplot">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Custom <code>gglaplot</code>s</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Greater-London-Authority/gglaplot/blob/master/vignettes/v03_Custom_ggla_plots.Rmd"><code>vignettes/v03_Custom_ggla_plots.Rmd</code></a></small>
      <div class="hidden name"><code>v03_Custom_ggla_plots.Rmd</code></div>

    </div>

    
    
<p><code>gglaplot</code> contains several functions that take standard ggplot objects/layers and customises them to fit better with our style guide for data vis. Some of these just change some default settings to change the look of a chart, and others create new chart types.</p>
<p>They can be used similarly to ggplot objects, either inheriting aesthetics from an earlier call to <code>ggplot()</code> or having their own aesthetics defined.</p>
<p>As with <code>ggplot()</code> these functions work best with, and are designed for, <strong>tidy</strong> data.</p>
<p>These are the packages we’ll need:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For data manipulation</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="co"># For plotting</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gglaplot)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(grid)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gridExtra)
<span class="co"># For working with dates</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate)
<span class="co"># For improving the labelling of our axis</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scales)
<span class="co"># For spatial data</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)
<span class="co"># For markdown table output</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(knitr)</code></pre></div>
<p>And we can set the GLA theme at the start:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">theme_set</span>(<span class="kw"><a href="../reference/theme_gla.html">theme_gla</a></span>())</code></pre></div>
<p>All the data used in this vignette is included in the <code>gglaplot</code> package.</p>
<div id="line-charts" class="section level2">
<h2 class="hasAnchor">
<a href="#line-charts" class="anchor"></a>Line charts</h2>
<p>We’ll use the dataset comparing gender pay gaps between London and the rest of the UK</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LDNUK <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Year</th>
<th align="left">location</th>
<th align="right">GPG</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1997-01-01</td>
<td align="left">London</td>
<td align="right">22.39777</td>
</tr>
<tr class="even">
<td align="left">1998-01-01</td>
<td align="left">London</td>
<td align="right">22.04301</td>
</tr>
<tr class="odd">
<td align="left">1999-01-01</td>
<td align="left">London</td>
<td align="right">21.87500</td>
</tr>
<tr class="even">
<td align="left">2000-01-01</td>
<td align="left">London</td>
<td align="right">23.87203</td>
</tr>
<tr class="odd">
<td align="left">2001-01-01</td>
<td align="left">London</td>
<td align="right">23.35938</td>
</tr>
<tr class="even">
<td align="left">2002-01-01</td>
<td align="left">London</td>
<td align="right">23.26622</td>
</tr>
</tbody>
</table>
<div id="using-ggla_line" class="section level3">
<h3 class="hasAnchor">
<a href="#using-ggla_line" class="anchor"></a>Using <code><a href="../reference/ggla_line.html">ggla_line()</a></code>
</h3>
<p><code><a href="../reference/ggla_line.html">ggla_line()</a></code> is the same as <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">ggplot2::geom_line()</a></code> except that it uses a round <code>lineend</code> style as default.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gla_pal.html">gla_pal</a></span>(<span class="dt">gla_theme =</span> <span class="st">"default"</span>, <span class="dt">palette_type =</span> <span class="st">"highlight"</span>, <span class="dt">n =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))

plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> LDNUK, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> GPG,
                                           <span class="dt">group =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> pal) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_line.html">ggla_line</a></span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">colour =</span> location))

plot</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-4-1.png" width="2187.5"></p>
</div>
<div id="adding-emphasis-with-ggla_highlight" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-emphasis-with-ggla_highlight" class="anchor"></a>Adding emphasis with <code><a href="../reference/ggla_highlight.html">ggla_highlight()</a></code>
</h3>
<p>To highlight particular features of your data you can add emphasis with <code><a href="../reference/ggla_highlight.html">ggla_highlight()</a></code>. This comes in 4 simple flavours, “start” and “end”, for highlighting your first or final data point, “min” and “max” for highlighting your minimum or maximum data points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_start &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="kw">aes</span>(<span class="dt">colour =</span> location), <span class="dt">filter_type =</span> <span class="st">"start"</span>)
p_end &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="kw">aes</span>(<span class="dt">colour =</span> location), <span class="dt">filter_type =</span> <span class="st">"end"</span>)
p_min &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="kw">aes</span>(<span class="dt">colour =</span> location), <span class="dt">filter_type =</span> <span class="st">"min"</span>)
p_max &lt;-<span class="st"> </span>plot <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="kw">aes</span>(<span class="dt">colour =</span> location), <span class="dt">filter_type =</span> <span class="st">"max"</span>)
<span class="kw">grid.arrange</span>(p_start, p_end, p_min, p_max, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-5-1.png" width="2187.5"></p>
<p><code><a href="../reference/ggla_highlight.html">ggla_highlight()</a></code> also includes a more involved <code>xy</code> option for the <code>filter_type</code> argument for cases when you want to pick out a particular value which isn’t covered by start/end etc. This needs to be used along with at least one of the x_filt and y_filt arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="kw">aes</span>(<span class="dt">colour =</span> location), <span class="dt">filter_type =</span> <span class="st">"xy"</span>, <span class="dt">x_filt =</span> <span class="kw">ymd</span>(<span class="st">"2007-01-01"</span>))</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-6-1.png" width="2187.5"></p>
<p>You can also change the <code>geom</code> of <code><a href="../reference/ggla_highlight.html">ggla_highlight()</a></code> to add labels. This will probably require a bit of fiddling around with the <code>position_nudge()</code> function to get them in the right place. If we’re labelling our data we might as well remove the legend. <code>GeomGLATextHighlight</code> is a custom <code>gglaplot</code> geom.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/theme_gla.html">theme_gla</a></span>(<span class="dt">legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">label =</span> location),
                 <span class="dt">filter_type =</span> <span class="st">"end"</span>, <span class="dt">geom =</span> GeomGLATextHighlight,
                 <span class="dt">position =</span> <span class="kw">position_nudge</span>(<span class="dt">x =</span> <span class="op">-</span><span class="dv">35</span>, <span class="dt">y =</span> <span class="fl">0.5</span>))</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-7-1.png" width="2187.5"></p>
</div>
</div>
<div id="highlighting-an-area-with-ggla_highlightarea" class="section level2">
<h2 class="hasAnchor">
<a href="#highlighting-an-area-with-ggla_highlightarea" class="anchor"></a>Highlighting an area with <code><a href="../reference/ggla_highlightarea.html">ggla_highlightarea()</a></code>
</h2>
<p>Areas of the graph can be highlighted with <code><a href="../reference/ggla_highlightarea.html">ggla_highlightarea()</a></code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_highlightarea.html">ggla_highlightarea</a></span>(<span class="dt">xmin =</span> <span class="kw">ymd</span>(<span class="st">"2007-01-01"</span>), <span class="dt">xmax =</span> <span class="kw">ymd</span>(<span class="st">"2012-01-01"</span>))</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-8-1.png" width="2187.5"></p>
</div>
<div id="adding-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-lines" class="anchor"></a>Adding lines</h2>
<p>Different points in the data can also be highlighted by adding lines</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_labelline.html">ggla_labelline</a></span>(<span class="dt">x1 =</span> <span class="kw">ymd</span>(<span class="st">"2000-01-01"</span>))</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-9-1.png" width="2187.5"></p>
</div>
<div id="extending-the-y-axis-to-0-" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-the-y-axis-to-0-" class="anchor"></a>Extending the y-axis to 0.</h2>
<p>If 0 is a meaningful number and the size of the plot allows it, it’s a good idea to include y=0 in your plot. <code>ggla_axisat0</code> will do this for you, as well as making it stronger than other grid lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_axisat0.html">ggla_axisat0</a></span>()</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-10-1.png" width="2187.5"></p>
</div>
<div id="putting-it-all-together-with-a-few-other-formatting-tweeks" class="section level2">
<h2 class="hasAnchor">
<a href="#putting-it-all-together-with-a-few-other-formatting-tweeks" class="anchor"></a>Putting it all together with a few other formatting tweeks</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> LDNUK, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> GPG, <span class="dt">group =</span> location,
                                   <span class="dt">colour =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add the ggla_line layer with an added aesthetic controlling</span>
<span class="st">  </span><span class="co"># the thickness of the lines</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_line.html">ggla_line</a></span>(<span class="kw">aes</span>(<span class="dt">size =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Control the scaling of the thickness, want London (location = 1)</span>
<span class="st">  </span><span class="co"># to be thicker than UK (location = 2)</span>
<span class="st">  </span><span class="kw">scale_size_discrete</span>(<span class="dt">range =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">6</span> <span class="op">*</span><span class="st"> </span>mm_to_pt, <span class="dv">3</span> <span class="op">*</span><span class="st"> </span>mm_to_pt)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add the palette</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> pal) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add some emphasis to the min values</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_highlight.html">ggla_highlight</a></span>(<span class="dt">filter_type =</span> <span class="st">"min"</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add a context/highlight box between 2007 - 2012</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_highlightarea.html">ggla_highlightarea</a></span>(<span class="dt">xmin =</span> <span class="kw">ymd</span>(<span class="st">"2007-01-01"</span>), <span class="dt">xmax =</span> <span class="kw">ymd</span>(<span class="st">"2012-01-01"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add an annotation using custom gglaplot geom GeomGLAAnnotate</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> GeomGLAAnnotate, <span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">"2007-02-01"</span>), <span class="dt">y =</span> <span class="fl">30.25</span>, <span class="dt">label =</span> <span class="st">"Highlight"</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add a line at 2000</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_labelline.html">ggla_labelline</a></span>(<span class="dt">x1 =</span> <span class="kw">ymd</span>(<span class="st">"2000-01-01"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Extend the y axis to 0</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_axisat0.html">ggla_axisat0</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="co"># Format the y-axis</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">32.5</span>),
                      <span class="dt">labels =</span> <span class="kw">dollar_format</span>(<span class="dt">prefix =</span> <span class="st">""</span>, <span class="dt">suffix =</span> <span class="st">"%"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Format the x-axis</span>
<span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">"1 year"</span>, <span class="dt">date_labels =</span> <span class="st">"%y"</span>,
               <span class="dt">expand =</span> <span class="kw">expand_scale</span>(<span class="dt">mult =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.01</span>))) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add titles and captions</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">"Gender Pay Gap - Total (Median)"</span>,
    <span class="dt">subtitle =</span> <span class="st">"Gender Pay Gap - Total (Median) - London VS UK"</span>,
    <span class="dt">caption =</span> <span class="st">"Note: 2017 data is provisional</span><span class="ch">\n</span><span class="st">Chart: GLA City Intelligence  Source: London Datastore"</span>
    )
Warning<span class="op">:</span><span class="st"> </span>Using size <span class="cf">for</span> a discrete variable is not advised.</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-11-1.png" width="2187.5"></p>
</div>
<div id="bar-charts" class="section level2">
<h2 class="hasAnchor">
<a href="#bar-charts" class="anchor"></a>Bar charts</h2>
<p>We’ll use some data comparing Early Years Foundation Stage tests (EYFSP) by ethnicity for London and England</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EYFSP <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Ethnicity</th>
<th align="left">Region</th>
<th align="right">eyfsp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">White</td>
<td align="left">London</td>
<td align="right">73</td>
</tr>
<tr class="even">
<td align="left">Mixed</td>
<td align="left">London</td>
<td align="right">75</td>
</tr>
<tr class="odd">
<td align="left">Asian</td>
<td align="left">London</td>
<td align="right">73</td>
</tr>
<tr class="even">
<td align="left">Black</td>
<td align="left">London</td>
<td align="right">70</td>
</tr>
<tr class="odd">
<td align="left">Chinese</td>
<td align="left">London</td>
<td align="right">79</td>
</tr>
<tr class="even">
<td align="left">All pupils</td>
<td align="left">London</td>
<td align="right">72</td>
</tr>
<tr class="odd">
<td align="left">White</td>
<td align="left">England</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="left">Mixed</td>
<td align="left">England</td>
<td align="right">71</td>
</tr>
<tr class="odd">
<td align="left">Asian</td>
<td align="left">England</td>
<td align="right">67</td>
</tr>
<tr class="even">
<td align="left">Black</td>
<td align="left">England</td>
<td align="right">68</td>
</tr>
<tr class="odd">
<td align="left">Chinese</td>
<td align="left">England</td>
<td align="right">72</td>
</tr>
<tr class="even">
<td align="left">All pupils</td>
<td align="left">England</td>
<td align="right">69</td>
</tr>
</tbody>
</table>
<p><code><a href="../reference/ggla_horizbar.html">ggla_horizbar()</a></code> makes horizontal bar charts, and can be used stacked or unstacked.</p>
<p>Here’s an unstacked, faceted example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">barplot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(EYFSP, <span class="kw">aes</span>(<span class="dt">x =</span> Ethnicity, <span class="dt">y =</span> eyfsp, <span class="dt">fill =</span> Region)) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add theme with gridlines and legend turned off</span>
<span class="st">  </span><span class="kw"><a href="../reference/theme_gla.html">theme_gla</a></span>(<span class="dt">xgridlines =</span> <span class="ot">FALSE</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add horizontal bar chart</span>
<span class="st">  </span><span class="co"># to100 adds a context bar behind the data up to 100%</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_horizbar.html">ggla_horizbar</a></span>(<span class="dt">to100 =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># Facet the data by region</span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>Region) <span class="op">+</span>
<span class="st">  </span><span class="co"># Add our palette</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> pal)

barplot</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-13-1.png" width="2187.5"></p>
<p>We can add some additional formatting and labels to this</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(barplot <span class="op">+</span>
<span class="st">   </span><span class="co"># Add formated labels to each bar</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(eyfsp, <span class="dt">nsmall =</span> <span class="dv">0</span>), <span class="st">"%"</span>, <span class="dt">sep =</span> <span class="st">""</span>)),
            <span class="dt">y =</span> <span class="dv">8</span>, <span class="dt">position =</span> <span class="kw">position_nudge</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>), <span class="dt">vjust =</span> <span class="fl">0.50</span>,
            <span class="dt">colour =</span> gla_default<span class="op">$</span>background) <span class="op">+</span>
<span class="st">   </span><span class="co"># Remove any labels from the x axis (effectively our y axis)</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">   </span><span class="co"># Add titles</span>
<span class="st">    </span><span class="kw">labs</span>(
      <span class="dt">title =</span> <span class="st">"Achievement in EYFSP by Ethnicity"</span>,
      <span class="dt">subtitle =</span> <span class="st">"Percentage achieving at least the expected standard in all ELGs (2017)"</span>,
      <span class="dt">caption =</span> <span class="st">"Source: Department for Education</span><span class="ch">\n</span><span class="st">Chart: GLA City Intelligence"</span>
      )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Make labels left aligned</span>
<span class="st">  </span><span class="kw"><a href="../reference/left_align_labs.html">left_align_labs</a></span>()</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-14-1.png" width="2187.5"></p>
<p>By default, <code>ggplot2</code> aligns the plot labels (titles, captions etc) to the panel of the plot itself, not the whole plot area. As the ethnicity labels extend out to the left hand side of the plot, this ends up making the plot look a bit misaligned. <code><a href="../reference/left_align_labs.html">left_align_labs()</a></code> will adjust the alignment to be with respect to the whole plot area. This needs to be applied to the whole <code>ggplot</code> object, not just + on the end.</p>
<p>And a stacked example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AvAtt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Region</th>
<th align="left">Subject</th>
<th align="right">Score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">London</td>
<td align="left">English</td>
<td align="right">10.6</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">English</td>
<td align="right">9.9</td>
</tr>
<tr class="odd">
<td align="left">London</td>
<td align="left">Mathematics</td>
<td align="right">9.5</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">Mathematics</td>
<td align="right">9.0</td>
</tr>
<tr class="odd">
<td align="left">London</td>
<td align="left">English Baccalaureate</td>
<td align="right">13.6</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">English Baccalaureate</td>
<td align="right">12.6</td>
</tr>
<tr class="odd">
<td align="left">London</td>
<td align="left">Open</td>
<td align="right">15.1</td>
</tr>
<tr class="even">
<td align="left">England</td>
<td align="left">Open</td>
<td align="right">14.9</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numcats &lt;-<span class="st"> </span>AvAtt <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Subject) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>()

pal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gla_pal.html">gla_pal</a></span>(<span class="dt">gla_theme =</span> <span class="st">"default"</span>, <span class="dt">palette_type =</span> <span class="st">"categorical"</span>, <span class="dt">n =</span> numcats)

(<span class="kw">ggplot</span>(AvAtt,
        <span class="kw">aes</span>(<span class="dt">x =</span> Region, <span class="dt">y =</span> Score, <span class="dt">fill =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(Subject),
            <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(Score, <span class="dv">1</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/theme_gla.html">theme_gla</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_horizbar.html">ggla_horizbar</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">position =</span> <span class="kw">position_stack</span>(<span class="dt">vjust =</span> <span class="fl">0.85</span>),
            <span class="dt">color =</span> gla_default<span class="op">$</span>background) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> pal,
                    <span class="dt">breaks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(AvAtt<span class="op">$</span>Subject))) <span class="op">+</span>
<span class="st">      </span><span class="kw">labs</span>(
        <span class="dt">title =</span> <span class="st">"Average Attainment 8 Scores - 2016/17"</span>,
        <span class="dt">subtitle =</span> <span class="st">"Average score per pupil in each element"</span>,
        <span class="dt">caption =</span> <span class="st">"Source: Department for Education</span><span class="ch">\n</span><span class="st">Chart: GLA City Intelligence"</span>
        )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/left_align_labs.html">left_align_labs</a></span>()</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-16-1.png" width="2100"></p>
</div>
<div id="donut-charts" class="section level2">
<h2 class="hasAnchor">
<a href="#donut-charts" class="anchor"></a>Donut charts</h2>
<p>We’ll use some data on internet useage in London to illustrate donut charts</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Internet <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">locat</th>
<th align="left">usage</th>
<th align="right">numUsers</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">London</td>
<td align="left">Used in last 3 months</td>
<td align="right">6591</td>
</tr>
<tr class="even">
<td align="left">London</td>
<td align="left">Not used in last 3 months</td>
<td align="right">496</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numcats &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(Internet)

pal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gla_pal.html">gla_pal</a></span>(<span class="dt">gla_theme =</span> <span class="st">"default"</span>, <span class="dt">palette_type =</span> <span class="st">"categorical"</span>, <span class="dt">n =</span> numcats)

<span class="kw">ggplot</span>(<span class="dt">data =</span> Internet, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> usage)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_donut.html">ggla_donut</a></span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">label =</span> usage, <span class="dt">y =</span> numUsers), <span class="dt">stat =</span> <span class="st">"identity"</span>,
             <span class="dt">title =</span> <span class="st">"Internet usage </span><span class="ch">\n</span><span class="st">in London"</span>, <span class="dt">base_size =</span> <span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> pal)</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-18-1.png" width="2187.5"></p>
</div>
<div id="maps" class="section level2">
<h2 class="hasAnchor">
<a href="#maps" class="anchor"></a>Maps</h2>
<p>We’ll use the results of the 2016 EU referendum in London to illustrate putting data on a map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EURef <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>geometry) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Area_Code</th>
<th align="left">Area</th>
<th align="right">Leave</th>
<th align="right">Remain</th>
<th align="right">PropLeave</th>
<th align="left">CatLeave</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E09000001</td>
<td align="left">City of London</td>
<td align="right">1087</td>
<td align="right">3312</td>
<td align="right">24.71016</td>
<td align="left">20% - 30%</td>
</tr>
<tr class="even">
<td align="left">E09000002</td>
<td align="left">Barking and Dagenham</td>
<td align="right">46130</td>
<td align="right">27750</td>
<td align="right">62.43909</td>
<td align="left">60% - 70%</td>
</tr>
<tr class="odd">
<td align="left">E09000003</td>
<td align="left">Barnet</td>
<td align="right">60823</td>
<td align="right">100210</td>
<td align="right">37.77052</td>
<td align="left">30% - 40%</td>
</tr>
<tr class="even">
<td align="left">E09000004</td>
<td align="left">Bexley</td>
<td align="right">80886</td>
<td align="right">47603</td>
<td align="right">62.95169</td>
<td align="left">60% - 70%</td>
</tr>
<tr class="odd">
<td align="left">E09000005</td>
<td align="left">Brent</td>
<td align="right">48881</td>
<td align="right">72523</td>
<td align="right">40.26309</td>
<td align="left">40% - 50%</td>
</tr>
<tr class="even">
<td align="left">E09000006</td>
<td align="left">Bromley</td>
<td align="right">90034</td>
<td align="right">92398</td>
<td align="right">49.35209</td>
<td align="left">40% - 50%</td>
</tr>
</tbody>
</table>
<p>The leave vote has been seperated out into categories for each Borough. The geometry of each Borough is available on the <a href="https://data.london.gov.uk/dataset/statistical-gis-boundary-files-london">DataStore</a>.</p>
<p>To plot geographical data, you can use the <code><a href="../reference/ggla_sf.html">ggla_sf()</a></code> which is similar to the <code>ggplot::geom_sf()</code> function with different defaults to fit with our style guide. This function works with <em>simple features data</em>, as used in the <a href="https://www.rdocumentation.org/packages/sf/versions/0.7-2">sf package</a>. The geometry here is polygons, but <code><a href="../reference/ggla_sf.html">ggla_sf()</a></code> works with other geometry types.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Generate a diverging palette - the edges get a bit dark so the remove margins</span>
pal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gla_pal.html">gla_pal</a></span>(<span class="dt">gla_theme =</span> <span class="st">"default"</span>, <span class="dt">palette_type =</span> <span class="st">"diverging"</span>,
               <span class="dt">main_colours =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="dt">n =</span> <span class="dv">6</span>, <span class="dt">remove_margin =</span> <span class="st">"both"</span>)

<span class="kw">ggplot</span>(EURef, <span class="kw">aes</span>(<span class="dt">geometry =</span> geometry, <span class="dt">fill =</span> CatLeave)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/ggla_sf.html">ggla_sf</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> pal) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">"Leave Vote in the 2016 EU Referendum"</span>,
    <span class="dt">caption =</span> <span class="st">"Contains Ordnance Survey data Crown copyright and database right [2015]"</span>
    )</code></pre></div>
<p><img src="v03_Custom_ggla_plots_files/figure-html/unnamed-chunk-20-1.png" width="2100" style="display: block; margin: auto auto auto 0;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#line-charts">Line charts</a></li>
      <li><a href="#highlighting-an-area-with-ggla_highlightarea">Highlighting an area with <code><a href="--/reference/ggla_highlightarea-html">ggla_highlightarea()</a></code></a></li>
      <li><a href="#adding-lines">Adding lines</a></li>
      <li><a href="#extending-the-y-axis-to-0-">Extending the y-axis to 0.</a></li>
      <li><a href="#putting-it-all-together-with-a-few-other-formatting-tweeks">Putting it all together with a few other formatting tweeks</a></li>
      <li><a href="#bar-charts">Bar charts</a></li>
      <li><a href="#donut-charts">Donut charts</a></li>
      <li><a href="#maps">Maps</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Libby Rogers, Mike Brondbjerg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
